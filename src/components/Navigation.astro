---
import ThemeToggle from "./ui/ThemeToggle.tsx";
import MotionToggle from "./ui/MotionToggle.tsx";
---

<nav
  class="sticky top-0 z-50 backdrop-blur supports-[backdrop-filter]:bg-bg/60 bg-bg/80 border-b border-border"
  role="navigation"
  aria-label="Primary"
>
  <div class="container mx-auto max-w-7xl px-4 sm:px-6">
    <div class="flex h-16 items-center justify-between">
      <!-- Brand -->
      <a href="/" class="flex items-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded-md px-2 py-1">
        <span class="inline-block h-2 w-2 rounded-full bg-primary ring-2 ring-primary/40"></span>
        <span class="font-semibold tracking-tight">Sanjay</span>
      </a>

      <!-- Desktop nav -->
      <ul class="hidden md:flex items-center gap-6 text-sm">
        <li><a href="/" class="text-token hover:text-primary focus-visible:ring-2 focus-visible:ring-ring rounded-md px-2 py-1">Home</a></li>
        <li><a href="/projects" class="text-token hover:text-primary focus-visible:ring-2 focus-visible:ring-ring rounded-md px-2 py-1">Projects</a></li>
        <li><a href="/about" class="text-token hover:text-primary focus-visible:ring-2 focus-visible:ring-ring rounded-md px-2 py-1">About</a></li>
        <li><a href="/articles" class="text-token hover:text-primary focus-visible:ring-2 focus-visible:ring-ring rounded-md px-2 py-1">Articles</a></li>
        <li><a href="/contact" class="text-token hover:text-primary focus-visible:ring-2 focus-visible:ring-ring rounded-md px-2 py-1">Contact</a></li>
        <li><a href="/resume" class="text-token hover:text-primary focus-visible:ring-2 focus-visible:ring-ring rounded-md px-2 py-1">Resume</a></li>
      </ul>

      <!-- Utilities -->
      <div class="hidden md:flex items-center gap-3">
        <ThemeToggle client:load />
        <MotionToggle client:load />
      </div>

      <!-- Mobile: hamburger and utilities inline -->
      <div class="md:hidden flex items-center gap-2">
        <ThemeToggle client:load />
        <MotionToggle client:load />
        <button
          class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-border bg-card text-fg hover:bg-bg/60 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring"
          type="button"
          aria-controls="mobile-menu"
          aria-expanded="false"
          aria-label="Open menu"
          data-menu-toggle
        >
          <span aria-hidden="true">â˜°</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu (CSS-only disclosure via :target fallback and noscript support with details) -->
  <div id="mobile-menu" class="md:hidden">
    <div class="px-4 pb-4 pt-2 border-t border-border bg-bg/95">
      <ul class="grid gap-2 text-sm">
        <li><a href="/" class="block rounded-md px-3 py-2 hover:bg-card focus-visible:ring-2 focus-visible:ring-ring">Home</a></li>
        <li><a href="/projects" class="block rounded-md px-3 py-2 hover:bg-card focus-visible:ring-2 focus-visible:ring-ring">Projects</a></li>
        <li><a href="/about" class="block rounded-md px-3 py-2 hover:bg-card focus-visible:ring-2 focus-visible:ring-ring">About</a></li>
        <li><a href="/articles" class="block rounded-md px-3 py-2 hover:bg-card focus-visible:ring-2 focus-visible:ring-ring">Articles</a></li>
        <li><a href="/contact" class="block rounded-md px-3 py-2 hover:bg-card focus-visible:ring-2 focus-visible:ring-ring">Contact</a></li>
        <li><a href="/resume" class="block rounded-md px-3 py-2 hover:bg-card focus-visible:ring-2 focus-visible:ring-ring">Resume</a></li>
      </ul>
    </div>
  </div>
</nav>

<style>
  /* Progressive enhancement: basic CSS-only toggle using :has when available */
  @supports selector(nav:has(button[data-menu-toggle][aria-expanded="true"])) {
    nav:has(button[data-menu-toggle][aria-expanded="true"]) #mobile-menu {
      display: block;
    }
  }
</style>

<script is:raw>
  // Small progressive enhancement for mobile menu: no framework, accessibility friendly
  (function () {
    const nav = document.currentScript?.closest('nav');
    if (!nav) return;
    const btn = nav.querySelector('button[data-menu-toggle]');
    const menu = nav.querySelector('#mobile-menu');
    if (!btn || !menu) return;

    function closeOnEscape(e) {
      if (e.key === 'Escape') {
        btn.setAttribute('aria-expanded', 'false');
        btn.setAttribute('aria-label', 'Open menu');
      }
    }

    btn.addEventListener('click', () => {
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      btn.setAttribute('aria-label', expanded ? 'Open menu' : 'Close menu');
    });

    document.addEventListener('keydown', closeOnEscape);
  })();
</script>